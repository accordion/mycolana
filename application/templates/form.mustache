<div id="table"></div>
<script type="text/javascript">
    function goTo(model, id) {
        document.location.href = '{{base_url}}detail/'+model+'/'+id;
    }
    
    function RelatedObject(model, id, target) {
        construct();
        
        function construct() {
            get_belongs_to_data();         
        }
        
        function get_belongs_to_data() {
            $.getJSON('{{base_url}}json/'+model+'/'+id+'?withHeading', function(data) {
                table = '<table>'
                // change button
                table += '<button id="change_'+model+'" onclick="return false">Change</button>';
                //heading
                table += '<tr>';
                $.each(data.heading, function(key, value) {
                    table += '<th>' + value + '</th>';            
                });
                table += '</tr>';
                // data
                $.each(data.data, function(key, value) {
                    table += '<tr onclick=\'goTo("'+model+'", '+value.id+')\'>';
                    $.each(value, function(key, value) {
                        table += '<td>' + value + '</td>';
                    });
                     table += '</tr>';           
                });               
                table += '</table>';
                
                $(target).html(table);
                // add change button listener
                change_button_listener();
            });

            function change_button_listener() {
                $("#change_"+model).click(function() {
                    $(target).load('{{base_url}}detail/'+model+'?search', function() {
                        var form = $("#form_"+model);
                        // configure form
                        form.ajaxForm({
                            target: target
                        }); 
                    });
                });
            }
        }
        
    }
    
$(document).ready(function() {
    $.each($("#form_{{model}} input:hidden"), function(key, input) { 
        var model = input.id;
        var id = input.value;
        if(id != '') {
            RelatedObject(model, id, '#field_'+input.name);
        }
    });    
});
</script>

{{#form}}
    {{&open}}
    
    {{#elements}}
        {{&label}}
        <br />
        {{&input}}
        {{&error}}
        {{&div}}
    {{/elements}}

    {{#close}}
        {{&element}}
    {{/close}}
{{/form}}